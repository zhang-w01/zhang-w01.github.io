---
layout: post
title: EFS文件加密系统
categories: [PUF]
description: 我没有指定这个查询要分页，但是 PageHelper 自作主张帮我分页了，这是怎么回事？
keywords: PUF
mermaid: false
sequence: false
flow: false
mathjax: false
mindmap: false
mindmap2: false


---

# EFS文件加密系统

EFS(Encrypting File System，加密文件系统)是Windows所特有的一个实用功能，对于NTFS卷上的文件和数据，都可以直接加密保存，在很大程度上提高了数据的安全性。

EFS加密是基于<mark>公钥</mark>策略的。在使用EFS加密一个文件或文件夹时，系统首先会生成一个由伪随机数组成的FEK(File Encryption Key，文件加密钥匙)，然后将利用FEK和数据扩展标准X算法创建加密后的文件，并把它存储到硬盘上，同时删除未加密的原始文件。随后系统利用你的公钥加密FEK，并把加密后的FEK存储在同一个加密文件中。而在访问被加密的文件时，系统首先利用当前用户的私钥解密FEK，然后利用FEK解密出文件。在首次使用EFS时，如果用户还没有公钥/私钥对(统称为密钥)，则会首先生成密钥，然后加密数据。

## 使用方式

右击要加密的文件夹，单击“属性”，再单击“高级”按钮；勾选“

![](../images/posts/zhangwang/4.png)

EFS加密系统对用户是透明的。这也就是说，如果你加密了一些数据，那么你对这些数据的访问将是完全允许的，并不会受到任何限制。而其他非授权用户试图访问加密过的数据时，就会收到“访问拒绝”的错误提示。<mark>EFS加密的用户验证过程是在登录Windows时进行的</mark>，只要登录到Windows，就可以打开任何一个被授权的加密文件。

## EFS证书

在Microsoft管理控制台管理单元中可以看到

在命令行里面输入`mmc`，点击“文件”，选择“添加和删除管理单元”，再点击证书，添加后返回就可以看到自己的证书。

![](../images/posts/zhangwang/5.png)

下面介绍的是加密文件系统证书的备份与恢复。

l  备份EFS密钥

　　使用Windows 2000/XP的EFS加密后，如果重装系统，那么原来被加密的文件就无法打开了!如果你没有事先做好密钥的备份，那么数据是永远打不开的。由此可见，做好密钥的被备份就很重要。

　　第一步：首先以本地帐号登录，最好是具有管理员权限的用户。然后单击“开始→运行”，输入“MMC”后回车，打开控制面板界面。

　　第二步：单击控制面板的“控制面板→添加删除管理单元”，在弹出的“添加/删除管理单元”对话框中单击“添加”按钮，在“添加独立管理单元”对话框中选择“证书”后，单击“添加”按钮添加该单元。

　　如果是管理员，会要求选择证书方式，选择“我的用户证书”，然后单击“关闭”按钮，单击“确定”按钮返回控制面板。

　　第三步：依次展开左边的“控制面板根节点→证书→个人→证书→选择右边窗口中的账户”，右击选择“所有任务→导出”，弹出“证书导出向导”。

　　第四步：单击“下一步”按钮，选择“是，导出私钥”，单击“下一步”按钮，勾选“私人信息交换”下面的“如果可能，将所有证书包括到证书路径中”和“启用加强保护”项，单击“下一步”按钮，进入设置密码界面。

　　第五步：输入设置密码，这个密码非常重要，一旦遗忘，将永远无法获得，以后也就无法导入证书。输入完成以后单击“下一步”按钮，选择保存私钥的位置和文件名。

　　第六步：单击“完成”按钮，弹出“导出成功”对话框，表示你的证书和密钥已经导出成功了，打开保存密钥的路径，会看到一个“信封+钥匙”的图标，这就是你宝贵的密钥!丢失了它，不仅仅意味着你再也打不开你的数据，也意味着别人可以轻易打开你的数据。

l  恢复EFS密钥

　　由于重装系统后，对于被EFS加密的文件我们是不能够打开的，所以重装系统以前，一定记住导出密钥，然后在新系统中将备份的密钥导入，从而获得权限。

*　　★确保你导入的密钥有查看的权利，否则就是导入了也没有用的。这一点要求在导出时就要做到*

*　　★记住导出时设置的密码，最好使用和导出是相同的用户名。*

　　第一步：双击导出的密钥(就是那个“信封+钥匙”图标的文件)，会看到“证书导入向导”欢迎界面，单击“下一步”按钮，确认路径和密钥证书，然后单击“下一步”继续。

　　第二步：在“密码”后面输入导出时设置的密码，把密码输入后勾选“启用强密钥保护”和“标志此密钥可导出”(以确保下次能够导出)，然后单击“下一步”继续。

　　第三步：根据提示，依次单击“下一步”按钮，OK了，单击完成按钮，看到“导入成功”就表示你已经成功导入密钥了。
